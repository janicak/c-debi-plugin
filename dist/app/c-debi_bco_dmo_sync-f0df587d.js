/*!
 * 
 * cDebi
 * 
 * @author 
 * @version 0.1.0
 * @link UNLICENSED
 * @license UNLICENSED
 * 
 * Copyright (c) 2020 
 * 
 * This software is released under the UNLICENSED License
 * https://opensource.org/licenses/UNLICENSED
 * 
 * Compiled with the help of https://wpack.io
 * A zero setup Webpack Bundler Script for WordPress
 */
(window.wpackiocDebiappJsonp=window.wpackiocDebiappJsonp||[]).push([[3],{272:function(e,t,n){n(29),e.exports=n(278)},278:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),o=n(24),l=n.n(o),i=n(28),s=n(32),u=n(23),p=n(3),d=n(10),m=n.n(d),f=n(15),g=n(47),b=n.n(g),h=n(48),O=n.n(h),y=function(e){var t=window.c_debi_plugin,n=t.ajax_url,a=t.action,r=t.nonce,c=t.route;return new Promise((function(t,o){b()({method:"POST",url:n,headers:{"content-type":"application/x-www-form-urlencoded"},data:O.a.stringify({action:a,nonce:r,route:c,reqs:e})}).then((function(e){e.data.success?t(e.data.data):o(e.data.data)})).catch((function(e){return o(e)}))}))},w=Object(s.b)("form/syncEntities",(function(e,t){return new Promise((function(n,a){(function(e){return y([{method:"trigger_bcodmo_sync",args:e}])})(e).then((function(e){n(e)}),(function(e){a(e)})),window.setTimeout((function(){t.dispatch(j())}),2e3)}))})),j=Object(s.b)("form/getSyncStatus",function(){var e=Object(f.a)(m.a.mark((function e(t,n){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y([{method:"check_bcodmo_sync_status"}]);case 2:return a=e.sent,window.setTimeout((function(){n.getState().form.loading&&n.dispatch(j())}),2e3),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),v=Object(s.b)("form/linkPeople",(function(e){return function(e){return y([{method:"trigger_link_people",args:e}])}(e)})),E=Object(s.c)({name:"form",initialState:{loading:!1,syncStatusMessage:"",syncStatusPercentage:0,unlinkedPeople:{},linkPeopleStatusMessage:""},reducers:{},extraReducers:(a={},Object(p.a)(a,w.pending,(function(e,t){console.log(t),e.loading=!0,e.syncStatusMessage="Starting BCO-DMO update",e.syncStatusPercentage=0,e.unlinkedPeople={},e.linkPeopleStatusMessage=""})),Object(p.a)(a,j.pending,(function(e,t){console.log(t)})),Object(p.a)(a,j.rejected,(function(e,t){console.log(t)})),Object(p.a)(a,j.fulfilled,(function(e,t){e.loading&&(console.log(t),e.syncStatusMessage=t.payload.statusMessage,e.syncStatusPercentage=t.payload.statusPercentage)})),Object(p.a)(a,w.rejected,(function(e,t){console.log(t),e.loading=!1,e.syncStatusMessage="Error: ".concat(t.payload),e.syncStatusPercentage=0})),Object(p.a)(a,w.fulfilled,(function(e,t){if(console.log(t),e.loading=!1,e.syncStatusPercentage=100,e.syncStatusMessage="Completed. ",t.payload.hasOwnProperty("datasets")&&t.payload.hasOwnProperty("data_projects")){var n=t.payload,a=n.datasets,r=n.data_projects;e.syncStatusMessage+=" \n          Datasets: ".concat(a.created," created, ").concat(a.updated," updated;\n          Data Projects: ").concat(r.created," created, ").concat(r.updated," updated. ")}if(t.payload.hasOwnProperty("unlinked_people")){var c=t.payload.unlinked_people;e.unlinkedPeople=c;var o=Object.keys(c).length;e.syncStatusMessage+="".concat(o," unlinked ").concat(1===o?"person":"people"," returned. ")}})),Object(p.a)(a,v.pending,(function(e,t){console.log(t),e.loading=!0,e.linkPeopleStatusMessage="Updating"})),Object(p.a)(a,v.rejected,(function(e,t){console.log(t),e.loading=!1,e.linkPeopleStatusMessage="Error: ".concat(t.payload)})),Object(p.a)(a,v.fulfilled,(function(e,t){console.log(t),e.loading=!1;var n=t.payload,a=n.rows_updated,r=n.people_created;e.linkPeopleStatusMessage="Completed. \n        ".concat(a," ").concat(1===parseInt(r)?"row":"rows"," updated; \n        ").concat(r," ").concat(1===parseInt(r)?"person":"people"," created.")})),a)}).reducer,x=Object(u.c)({form:E});var k=Object(s.a)({reducer:x}),_=n(7),P=n(6),S=n(8),M=n(49);function N(){var e=Object(_.a)(["\n  margin-top: 16px;\n  background-color: white;\n  padding: 1rem 1rem;\n  border: 1px solid #ccd0d4;\n  box-shadow: 0 1px 1px rgba(0,0,0,.04);\n  h2 {\n    margin-top: 0;\n  }\n"]);return N=function(){return e},e}var C=P.c.div(N()),D=function(e){var t=e.heading,n=e.children;return c.a.createElement(C,null,c.a.createElement("h2",null,t),n)};function B(){var e=Object(_.a)(["\n  &:after {\n    overflow: hidden;\n    display: inline-block;\n    vertical-align: bottom;\n    animation: ",' steps(4,end) 2000ms infinite;\n    content: "\\2026"; /* ascii code for the ellipsis character */\n    width: 0px;\n  }\n'],["\n  &:after {\n    overflow: hidden;\n    display: inline-block;\n    vertical-align: bottom;\n    animation: ",' steps(4,end) 2000ms infinite;\n    content: "\\\\2026"; /* ascii code for the ellipsis character */\n    width: 0px;\n  }\n']);return B=function(){return e},e}function I(){var e=Object(_.a)(["\n  to {\n    width: 1em;    \n  }\n"]);return I=function(){return e},e}var L=Object(P.d)(I()),T=Object(P.c)("span")(B(),L),U=function(){return c.a.createElement(T,null)};function F(){var e=Object(_.a)(["\n  margin-top: 12px;\n  label {\n    font-weight: bold;\n  }\n  .progress-bar {\n    height: 15px;\n    width: 100%;\n    margin-top: 4px;\n    box-shadow: inset 0.75px 0.5px 4px 0px #4c4c4cc2;\n    .progress-bar-fill {\n      background: #007cba87;\n      height: 100%;\n      transition: width .5s ease-in;\n    }\n  }\n  .status-message {\n    margin-top: 3px;\n    .message {\n      margin-right: 3px;\n      font-style: italic;\n    }\n  } \n"]);return F=function(){return e},e}function J(){var e=Object(_.a)(["\n  & > label {\n    font-weight: bold;\n  }\n  .options {\n    margin-top: 4px;\n    display: flex;\n    flex-direction: column;\n    label {\n      margin-right: 8px;\n      input {\n        position: relative;\n        top: 1px;\n      }\n    }\n    .subOptions {\n      margin-left: 19px;\n      margin-top: 2px;\n      margin-bottom: 5px;\n    }\n  }\n  input.button-primary {\n    margin-top: 12px;\n    width: 150px;\n  }\n"]);return J=function(){return e},e}var R=P.c.form(J()),V=function(){var e=Object(i.d)((function(e){return e.form})).loading,t=Object(i.c)(),n=Object(M.a)(),a=n.register,o=n.handleSubmit,l=n.getValues,s=Object(r.useState)(e),u=Object(S.a)(s,2),p=u[0],d=u[1],m=Object(r.useState)(!0),f=Object(S.a)(m,2),g=f[0],b=f[1],h=function(){var t=l();b(t.trigger_sync);var n=t.trigger_sync||t.find_unlinked_people;d(!n||e)};return c.a.createElement(R,{onSubmit:o((function(e){t(w(e))}))},c.a.createElement("label",null,"Options: "),c.a.createElement("div",{className:"options"},c.a.createElement("label",null,c.a.createElement("input",{type:"checkbox",ref:a,name:"trigger_sync",defaultChecked:!0,onChange:function(){return h()}}),"Update / create local Datasets, Projects",c.a.createElement("div",{className:"subOptions".concat(g?"":" hidden")},c.a.createElement("label",null,c.a.createElement("input",{type:"radio",ref:a,name:"use_cache",value:"false",defaultChecked:!0}),"Fetch latest metadata from remote server"),c.a.createElement("label",null,c.a.createElement("input",{type:"radio",ref:a,name:"use_cache",value:"true"}),"Used last cached response from remote server"))),c.a.createElement("label",null,c.a.createElement("input",{type:"checkbox",ref:a,name:"find_unlinked_people",defaultChecked:!0,onChange:function(){return h()}}),"Link remote metadata with local Person entities, and return form to manually pair novel entries")),c.a.createElement("input",{className:"button-primary",type:"submit",value:"Submit",disabled:p}))},X=P.c.div(F()),q=function(){var e=Object(i.d)((function(e){return e.form})),t=e.loading,n=e.syncStatusMessage,a=e.syncStatusPercentage;return c.a.createElement(X,null,c.a.createElement("label",null,"Progress: "),c.a.createElement("div",{className:"progress-bar"},c.a.createElement("div",{className:"progress-bar-fill",style:{width:"".concat(a,"%")}})),c.a.createElement("div",{className:"status-message"},c.a.createElement("span",{className:"message"},n),t&&c.a.createElement(U,null)))},W=function(){return c.a.createElement(D,{heading:"Part 1: Reconcile remote (BCO-DMO) and local (website) metadata"},c.a.createElement(V,null),c.a.createElement(q,null))};function z(){var e=Object(_.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  table {\n    border: 1px solid #ccd0d4;\n    box-shadow: 0 1px 1px rgba(0,0,0,.04);\n    background: #e6e6e6;\n    width: 100%;\n    border-spacing: 0;\n    thead tr th {\n      height: 24px;\n      background-color: white;\n      text-align: left;\n      &:first-child {\n        min-width: 125px;\n      }\n    }\n    td, th {\n      padding: 8px 10px;\n    }\n    tbody {\n     tr {\n      &:nth-child(even) {\n        background-color:white;\n      }\n      td {\n        &:first-child {\n          width:1%;\n          white-space:nowrap;\n        }\n        select {\n          width: 100%;\n          max-width: unset;\n        }\n      }\n     }\n    }\n  }\n  input.button-primary {\n    margin-top: 16px;\n    width: 150px;\n  }\n  .status-message {\n    margin-top: 3px;\n    font-style: italic;\n  }\n"]);return z=function(){return e},e}var A=P.c.form(z()),G=Object(i.b)(null,{linkPeople:v})((function(e){var t=e.linkPeople,n=Object(i.d)((function(e){return e.form})),a=n.unlinkedPeople,o=n.loading,l=n.linkPeopleStatusMessage,s=Object(M.a)(),u=s.register,p=s.handleSubmit,d=(s.getValues,Object(r.useState)(o)),m=Object(S.a)(d,2),f=m[0],g=m[1];return c.a.createElement(c.a.Fragment,null,a&&Object.entries(a).length?c.a.createElement(D,{heading:"Part 2: Link unpaired, BCO-DMO people with new or existing, local entities"},c.a.createElement(A,{onSubmit:p((function(e){var n=Object.entries(a).map((function(t){var n=Object(S.a)(t,2),a=n[0],r=n[1],c=r.instances,o=r.parsed_name,l="create_new"===e[a];return{instances:c,selected_entity:"create_new"!==e[a]?e[a]:null,create_new:l,parsed_name:o}}));t(n).then((function(){g(!1)})),g(!0)}))},c.a.createElement("table",null,c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"BCO-DMO people"),c.a.createElement("th",null,"Local entity matches"))),c.a.createElement("tbody",null,Object.entries(a).map((function(e){var t=Object(S.a)(e,2),n=t[0],a=t[1];return c.a.createElement("tr",{key:n},c.a.createElement("td",null,n),c.a.createElement("td",null,c.a.createElement("select",{name:n,ref:u},a.matched_person_posts.length&&a.matched_person_posts.map((function(e){var t=e.post_title,n=e.ID;return c.a.createElement("option",{key:n,value:n},t," [ID: ",n,"]")})),c.a.createElement("option",{value:"create_new"},'Create new person: "',a.parsed_name.post_title,'"'))))})))),c.a.createElement("input",{className:"button-primary",type:"submit",value:"Link People",disabled:f}),c.a.createElement("div",{className:"status-message"},c.a.createElement("span",{className:"message"},l),o&&c.a.createElement(U,null)))):"")})),H=n(26);function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Q(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Y={};function Z(e){var t=e.components,n=Q(e,["components"]);return Object(H.a)("wrapper",K({},Y,n,{components:t,mdxType:"MDXLayout"}),Object(H.a)("p",null,"Use this form to ",Object(H.a)("em",{parentName:"p"},"update")," the website's ",Object(H.a)("a",K({parentName:"p"},{href:"./edit.php?post_type=dataset"}),"dataset"),"\nand ",Object(H.a)("a",K({parentName:"p"},{href:"./edit.php?post_type=data_project"}),"data project")," entities with BCO-DMO's\n",Object(H.a)("a",K({parentName:"p"},{href:"https://www.bco-dmo.org/program/554979"}),"C-DEBI Program-affiliated"),"\ndatasets and projects. Where person names from the source data are unconnected to\n",Object(H.a)("a",K({parentName:"p"},{href:"./edit.php?post_type=person"}),"People")," entities on the website, you will be presented\nwith a form to confirm matches."),Object(H.a)("div",{className:"notice notice-warning inline"},Object(H.a)("p",null,"This will overwrite the website's data. ",Object(H.a)("em",{parentName:"p"},"Backup the database if you want an undo"),".")))}function $(){var e=Object(_.a)(["\n  max-width: 800px;\n"]);return $=function(){return e},e}Z.isMDXComponent=!0;var ee=P.c.div($()),te=function(){return c.a.createElement(ee,null,c.a.createElement(Z,null),c.a.createElement(W,null),c.a.createElement(G,null))};var ne=function(){return c.a.createElement(te,null)};l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(i.a,{store:k},c.a.createElement(ne,null))),document.getElementById("react-root"))}},[[272,0,1,7]]]);
//# sourceMappingURL=c-debi_bco_dmo_sync-f0df587d.js.map